extends layout.pug

block scripts
  title Liste des machines
  script(src="js/listeMachines.js")

block content
  .row
    h1 Liste des machines
  .row
    .col-md-3
      button.btn.btn-danger.back Retour
      button.btn.btn-info.parametrage Paramètrage
      button.btn.btn-success.declarerFLARM Enregistrer un FLARM
    .col-md-3
      .row
        label.col-sm-3.col-form-label(for="search") Recherche:&nbsp;&nbsp;
        .col-sm-9
          input.form-control(type="text" placeholder="immat / type / version flarm")#search
    .col-md-4.offset-md-2.text-end
      p.mb-0 Dernier téléchargement de la base de données&nbsp;
        a(href="http://wiki.glidernet.org/ddb") OGN
        | &nbsp;: #{timeago($ognDatabaseTimestamp)}
      p.mb-0 Dernier téléchargement de la base de données&nbsp;
        a(href="https://www.flarmnet.org/flarmnet/downloads/" target="_blank") flarmnet
        | &nbsp;: #{timeago($flarmnetDatabaseTimestamp)}
  .row
    .col-12
      table.table.table-striped#list
        thead
          tr
            th(width="10%") Voir
            th(width="20%") Immatriculation
            th(width="15%") Version FLARM
            th(width="15%") Dernière vérification FLARM
            th(width="30%") Détails
        tbody
          each glider in $gliders
            tr(x-num=$glider['id'])
              td
                button.btn.btn-primary.displayDetails
                  i.bi.bi-eye
                  span.d-none.d-sm-block2 &nbsp;Détails
              td
                b.display-6= $glider['immat'].' '
                if $glider['concours'] != ''
                  mark= '(' . $glider['concours'] . ') '
                = $glider['type']
              td
                if $glider['versionSoft'] != ''
                  if isAGoodFlarmVersion($glider['versionSoft'])
                   .alert.alert-success.text-center.mt-0.mb-0
                      = glider['versionSoft']
                  else
                    .alert.alert-danger.text-center.mt-0.mb-0
                      i.bi.bi-exclamation-triangle-fill.me-2
                      = glider['versionSoft']
                      i.bi.bi-exclamation-triangle-fill.ms-2
                else
                  .alert.alert-danger.text-center.mt-0.mb-0
                    i.bi.bi-exclamation-triangle-fill.me-2
                    | Pas de fichier IGC
                    i.bi.bi-exclamation-triangle-fill.ms-2
              td= timestampToDate($glider['when'])
                if $glider['who'] != null
                  = ' (par '.$getMembreNameByGivavNumber($glider['who']).')'
              td
                if $glider['rangeBelowMinimum'] === 1
                  .alert.alert-danger.text-center.mt-0.mb-0
                    span Portée en deça du minimum (aéronefs volants à 250 km/h)
                    br
                    span.small Valeurs relevées: #{$glider['rangeDetails']}
                else if $glider['rangeDetails'] != ''
                  span.small Valeurs relevées: #{$glider['rangeDetails']}
                if ($glider['flarmAircraftType'] != '') && ($glider['flarmAircraftType'] != $glider['aircraftType'])
                  .alert.alert-danger.text-center.mt-0.mb-0
                    span Le type d'aéronef configuré dans le FLARM (#{$glider['flarmAircraftType']}) ne correspond pas au type réel de l'aéronef (#{$glider['aircraftType']})
                if $glider['stealth'] === 1
                  .alert.alert-danger.text-center.mt-0.mb-0
                    span Mode stealth activé
                if $glider['noTrack'] === 1
                  .alert.alert-danger.text-center.mt-0.mb-0
                    span Mode noTrack activé
                if $glider['ognStatus']
                  .alert.alert-danger.text-center.mt-0.mb-0
                    span= $glider['ognStatus']
                if $glider['flarmnetStatus']
                  .alert.alert-danger.text-center.mt-0.mb-0
                    span= $glider['flarmnetStatus']

        tfoot
          tr
            th Voir
            th Immatriculation
            th Version FLARM
            th Dernière vérification FLARM
  .hstack.gap-4.mb-3
    button.btn.btn-danger.back Retour
    button.btn.btn-primary.addGlider Ajouter une machine

  .modal(tabindex="-1" role="dialog" aria-hidden="true")#modalAddGlider
    .modal-dialog
      .modal-content
        .modal-header
          h5 Ajouter une machine
          button.btn.btn-close(type="button" data-bs-dismiss="modal")
        .modal-body
          form(method="POST" action="/ajoutMachine")#formAddGlider
            .mb-3
              label.form-label(for="immat") Immatriculation
              input.form-control(type="text" name="immat" placeholder="F-CXXX")#immat
            .mb-3
              label.form-label(for="concours") Numéro de concours
              input.form-control(type="text" name="concours" placeholder="")#concours
            .mb-3
              label.form-label(for="type") Modèle
              input.form-control(type="text" name="type" placeholder="Discus")
            .mb-3
              label.form-label(for="typeAeronef") Type
              select.form-control(name="typeAeronef")#typeAeronef
                option(value="planeur") Planeur
                option(value="remorqueur") Remorqueur
        .modal-footer
          button.btn.btn-secondary(type="button" data-bs-dismiss="modal") Annuler
          button.btn.btn-primary(type="button")#addGlider Ajouter cette machine
